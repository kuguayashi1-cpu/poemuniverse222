<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>诗意星空 - 诗歌展览馆</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Han+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Han Serif SC', 'Source Han Serif CN', 'Noto Serif SC', 'Songti SC', 'SimSun', serif;
            background: radial-gradient(ellipse at center, #0a0e27 0%, #1a1a2e 30%, #16213e 60%, #0f1419 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* 返回按钮 */
        .back-btn {
            position: fixed;
            top: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(180, 200, 255, 0.3);
            border-radius: 50%;
            color: rgba(200, 220, 255, 0.8);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .back-btn:hover {
            border-color: rgba(200, 220, 255, 0.8);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(200, 220, 255, 0.4);
        }

        .back-btn::before {
            content: '←';
            font-size: 20px;
        }

        /* 标题 */
        .exhibition-title {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #c0d0ff, #a0b8ff, #80a0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            z-index: 100;
            text-align: center;
            animation: titleFloat 4s ease-in-out infinite;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* Three.js 容器 */
        #three-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* 诗歌漂浮高亮框 */
        .poetry-highlight {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(20, 30, 60, 0.8) 100%);
            border: 3px solid rgba(200, 220, 255, 0.6);
            border-radius: 25px;
            padding: 40px 50px;
            backdrop-filter: blur(25px);
            z-index: 200;
            max-width: 70%;
            text-align: center;
            min-width: 400px;
            box-shadow: 
                0 0 30px rgba(200, 220, 255, 0.3),
                0 0 60px rgba(180, 200, 255, 0.2),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            animation: highlightFloat 6s ease-in-out infinite;
        }

        @keyframes highlightFloat {
            0%, 100% { 
                transform: translate(-50%, -50%) translateY(0px) scale(1);
                box-shadow: 
                    0 0 30px rgba(200, 220, 255, 0.3),
                    0 0 60px rgba(180, 200, 255, 0.2),
                    inset 0 0 20px rgba(255, 255, 255, 0.1);
            }
            50% { 
                transform: translate(-50%, -50%) translateY(-10px) scale(1.02);
                box-shadow: 
                    0 0 40px rgba(200, 220, 255, 0.4),
                    0 0 80px rgba(180, 200, 255, 0.3),
                    inset 0 0 25px rgba(255, 255, 255, 0.15);
            }
        }

        .poetry-text {
            font-size: 2.2rem;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 20px;
            font-family: 'Source Han Serif SC', 'Source Han Serif CN', 'Noto Serif SC', 'Songti SC', 'SimSun', serif;
            font-weight: 600;
            text-shadow: 0 0 20px rgba(200, 220, 255, 0.5);
            animation: textGlow 3s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            0% { 
                text-shadow: 0 0 20px rgba(200, 220, 255, 0.5);
                color: rgba(255, 255, 255, 0.95);
            }
            100% { 
                text-shadow: 0 0 30px rgba(200, 220, 255, 0.8);
                color: rgba(255, 255, 255, 1);
            }
        }

        .poetry-id {
            font-size: 1rem;
            color: rgba(180, 200, 255, 0.7);
            font-style: italic;
            margin-top: 10px;
        }

        /* 隐藏菜单图标 */
        .menu-toggle {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(180, 200, 255, 0.3);
            border-radius: 50%;
            color: rgba(200, 220, 255, 0.8);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }

        .menu-toggle:hover {
            opacity: 1;
            border-color: rgba(200, 220, 255, 0.8);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(200, 220, 255, 0.4);
        }

        .menu-toggle::before {
            content: '☰';
        }

        /* 控制面板 - 隐藏状态 */
        .control-panel {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(180, 200, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            z-index: 100;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .control-panel.show {
            transform: translateX(0);
        }

        .control-btn {
            display: block;
            width: 100%;
            padding: 10px 20px;
            margin-bottom: 10px;
            background: rgba(180, 200, 255, 0.1);
            border: 1px solid rgba(180, 200, 255, 0.3);
            border-radius: 8px;
            color: rgba(200, 220, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .control-btn:hover {
            background: rgba(180, 200, 255, 0.2);
            border-color: rgba(200, 220, 255, 0.5);
        }

        .control-btn:last-child {
            margin-bottom: 0;
        }

        /* 统计信息 */
        .stats {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(180, 200, 255, 0.3);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            z-index: 100;
            font-size: 0.9rem;
            color: rgba(200, 220, 255, 0.7);
        }

        /* 星空背景层 */
        .starfield-background {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            overflow: hidden;
            background-image: 
                radial-gradient(1px 1px at 20px 30px, rgba(255,255,255,0.3), transparent),
                radial-gradient(1px 1px at 40px 70px, rgba(200,220,255,0.2), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(180,200,255,0.4), transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(220,240,255,0.3), transparent),
                radial-gradient(1px 1px at 160px 20px, rgba(160,180,255,0.4), transparent),
                radial-gradient(1px 1px at 190px 60px, rgba(240,250,255,0.3), transparent),
                radial-gradient(1px 1px at 220px 10px, rgba(170,190,255,0.4), transparent),
                radial-gradient(1px 1px at 250px 50px, rgba(190,210,255,0.3), transparent);
            background-repeat: repeat;
            background-size: 300px 300px;
            animation: starfieldTwinkle 8s ease-in-out infinite alternate;
        }

        @keyframes starfieldTwinkle {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }

        /* 动态星云效果 */
        .nebula-overlay {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
            background: 
                radial-gradient(ellipse 600px 400px at 30% 40%, rgba(40, 80, 140, 0.1) 0%, transparent 60%),
                radial-gradient(ellipse 400px 600px at 70% 60%, rgba(30, 60, 120, 0.15) 0%, transparent 60%),
                radial-gradient(ellipse 500px 300px at 20% 80%, rgba(50, 100, 150, 0.08) 0%, transparent 70%);
            animation: nebulaDrift 20s ease-in-out infinite;
        }

        @keyframes nebulaDrift {
            0%, 100% { 
                transform: translateX(0px) translateY(0px) scale(1);
                opacity: 0.6;
            }
            33% { 
                transform: translateX(20px) translateY(-15px) scale(1.05);
                opacity: 0.8;
            }
            66% { 
                transform: translateX(-15px) translateY(10px) scale(0.95);
                opacity: 0.7;
            }
        }

        /* 背景漂浮文字 */
        .floating-text-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
            overflow: hidden;
        }

        .floating-text-item {
            position: absolute;
            font-family: 'Source Han Serif SC', 'Source Han Serif CN', 'Noto Serif SC', 'Songti SC', 'SimSun', serif;
            font-size: 1.2rem;
            color: rgba(200, 220, 255, 0.2);
            font-weight: 500;
            animation: textFloatBg 12s ease-in-out infinite;
            text-shadow: 0 0 10px rgba(200, 220, 255, 0.1);
        }

        @keyframes textFloatBg {
            0%, 100% { 
                transform: translateY(0px) translateX(0px) rotate(0deg) scale(0.8); 
                opacity: 0.1;
            }
            25% { 
                transform: translateY(-40px) translateX(20px) rotate(2deg) scale(1.1); 
                opacity: 0.3;
            }
            50% { 
                transform: translateY(-20px) translateX(-15px) rotate(-1deg) scale(0.9); 
                opacity: 0.2;
            }
            75% { 
                transform: translateY(-35px) translateX(25px) rotate(1deg) scale(1.05); 
                opacity: 0.25;
            }
        }

        /* 加载提示 */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            color: rgba(200, 220, 255, 0.8);
            z-index: 500;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .exhibition-title {
                font-size: 1.8rem;
                top: 20px;
            }
            
            .poetry-panel {
                bottom: 20px;
                padding: 20px 25px;
                max-width: 90%;
            }
            
            .poetry-text {
                font-size: 1.4rem;
            }
            
            .control-panel {
                top: 20px;
                right: 20px;
                padding: 15px;
            }
            
            .stats {
                bottom: 20px;
                right: 20px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- 返回按钮 -->
    <a href="index.html" class="back-btn" title="返回主页"></a>
    
    <!-- 标题 -->
    <h1 class="exhibition-title">诗意星空 · 诗歌展览馆</h1>
    
    <!-- Three.js 容器 -->
    <div id="three-container"></div>
    
    <!-- 星空背景层 -->
    <div class="starfield-background"></div>
    
    <!-- 动态星云效果 -->
    <div class="nebula-overlay"></div>
    
    <!-- 背景漂浮文字 -->
    <div class="floating-text-bg" id="floatingTextBg"></div>
    
    <!-- 诗歌漂浮高亮框 -->
    <div class="poetry-highlight" id="poetryHighlight">
        <div class="poetry-text" id="poetryText">诗意星空正在加载...</div>
        <div class="poetry-id" id="poetryId"></div>
    </div>
    
    <!-- 隐藏菜单图标 -->
    <div class="menu-toggle" onclick="toggleMenu()" id="menuToggle"></div>
    
    <!-- 控制面板 -->
    <div class="control-panel" id="controlPanel">
        <button class="control-btn" onclick="toggleSound()" id="soundBtn">🔊 音效</button>
        <button class="control-btn" onclick="resetStars()">🔄 重置</button>
        <button class="control-btn" onclick="showAllPoetry()">📚 诗歌总览</button>
        <button class="control-btn" onclick="toggleAutoChange()" id="autoBtn">⏸️ 自动切换</button>
    </div>
    
    <!-- 统计信息 -->
    <div class="stats">
        <div>诗歌总数: <span id="totalCount">0</span></div>
        <div>已探索: <span id="exploredCount">0</span></div>
        <div>当前模式: <span id="currentMode">探索模式</span></div>
    </div>
    
    <!-- 加载提示 -->
    <div class="loading" id="loading">正在加载诗意星空...</div>

    <script>
        // 全局变量
        let scene, camera, renderer, stars = [];
        let poetryData = [];
        let exploredPoems = new Set();
        let soundEnabled = true;
        let currentMode = 'explore';
        let audioContext, backgroundSound;
        let autoChangeInterval;
        let autoChangeEnabled = true;
        let menuVisible = false;

        // 诗歌数据 - 本地生成的诗句
        const poetryDatabase = [
            {"id": 1, "text": "门外的风在等家"},
            {"id": 2, "text": "母亲的影子藏在月亮后"},
            {"id": 3, "text": "星星里有厨房的气味"},
            {"id": 4, "text": "记忆在太空中漂浮"},
            {"id": 5, "text": "无法打开的门后是故乡"},
            {"id": 6, "text": "时间在星尘中静止"},
            {"id": 7, "text": "家的信号穿越光年"},
            {"id": 8, "text": "漂浮的思念如彗星"},
            {"id": 9, "text": "月亮是故乡的钥匙"},
            {"id": 10, "text": "星空下的门永远关闭"},
            {"id": 11, "text": "记忆的碎片在宇宙中旋转"},
            {"id": 12, "text": "家的味道在真空中消散"},
            {"id": 13, "text": "无法抵达的故乡信号"},
            {"id": 14, "text": "漂浮在星海中的门"},
            {"id": 15, "text": "时间胶囊里的家"},
            {"id": 16, "text": "失重的思念飘向远方"},
            {"id": 17, "text": "星空是记忆的投影"},
            {"id": 18, "text": "门后的光年距离"},
            {"id": 19, "text": "漂浮的故乡在星云中"},
            {"id": 20, "text": "无法打开的家门"},
            {"id": 21, "text": "记忆在黑洞边缘徘徊"},
            {"id": 22, "text": "家的信号被星尘掩埋"},
            {"id": 23, "text": "漂浮的思念如流星"},
            {"id": 24, "text": "月亮是故乡的密码"},
            {"id": 25, "text": "星空下的门永远锁着"},
            {"id": 26, "text": "记忆的碎片在银河中漂流"},
            {"id": 27, "text": "家的味道在宇宙中稀释"},
            {"id": 28, "text": "无法接收的故乡信号"},
            {"id": 29, "text": "漂浮在星海中的钥匙"},
            {"id": 30, "text": "时间胶囊里的门"},
            {"id": 31, "text": "失重的家飘向虚无"},
            {"id": 32, "text": "星空是记忆的碎片"},
            {"id": 33, "text": "门后的光年等待"},
            {"id": 34, "text": "漂浮的故乡在星尘中"},
            {"id": 35, "text": "无法打开的记忆门"},
            {"id": 36, "text": "记忆在星云中迷失"},
            {"id": 37, "text": "家的信号被黑洞吞噬"},
            {"id": 38, "text": "漂浮的思念如星尘"},
            {"id": 39, "text": "月亮是故乡的锁"},
            {"id": 40, "text": "星空下的门永远关闭"},
            {"id": 41, "text": "记忆的碎片在星海中沉浮"},
            {"id": 42, "text": "家的味道在真空中蒸发"},
            {"id": 43, "text": "无法解码的故乡信号"},
            {"id": 44, "text": "漂浮在星海中的家"},
            {"id": 45, "text": "时间胶囊里的记忆"},
            {"id": 46, "text": "失重的门飘向深渊"},
            {"id": 47, "text": "星空是记忆的倒影"},
            {"id": 48, "text": "门后的光年沉默"},
            {"id": 49, "text": "漂浮的故乡在星云中消散"},
            {"id": 50, "text": "无法打开的时间门"},
            {"id": 51, "text": "记忆在星尘中燃烧"},
            {"id": 52, "text": "家的信号被星云遮蔽"},
            {"id": 53, "text": "漂浮的思念如星火"},
            {"id": 54, "text": "月亮是故乡的封印"},
            {"id": 55, "text": "星空下的门永远沉默"},
            {"id": 56, "text": "记忆的碎片在银河中燃烧"},
            {"id": 57, "text": "家的味道在宇宙中消失"},
            {"id": 58, "text": "无法破译的故乡信号"},
            {"id": 59, "text": "漂浮在星海中的时间"},
            {"id": 60, "text": "时间胶囊里的门锁"},
            {"id": 61, "text": "失重的记忆飘向永恒"},
            {"id": 62, "text": "星空是记忆的灰烬"},
            {"id": 63, "text": "门后的光年寂静"},
            {"id": 64, "text": "漂浮的故乡在星尘中湮灭"},
            {"id": 65, "text": "无法打开的空间门"},
            {"id": 66, "text": "记忆在星海中沉没"},
            {"id": 67, "text": "家的信号被星尘掩埋"},
            {"id": 68, "text": "漂浮的思念如星尘"},
            {"id": 69, "text": "月亮是故乡的墓碑"},
            {"id": 70, "text": "星空下的门永远关闭"},
            {"id": 71, "text": "记忆的碎片在银河中沉没"},
            {"id": 72, "text": "家的味道在真空中消失"},
            {"id": 73, "text": "无法接收的故乡信号"},
            {"id": 74, "text": "漂浮在星海中的记忆"},
            {"id": 75, "text": "时间胶囊里的故乡"},
            {"id": 76, "text": "失重的家飘向虚无"},
            {"id": 77, "text": "星空是记忆的坟墓"},
            {"id": 78, "text": "门后的光年等待"},
            {"id": 79, "text": "漂浮的故乡在星云中消散"},
            {"id": 80, "text": "无法打开的记忆门"},
            {"id": 81, "text": "记忆在星尘中燃烧"},
            {"id": 82, "text": "家的信号被星云遮蔽"},
            {"id": 83, "text": "漂浮的思念如星火"},
            {"id": 84, "text": "月亮是故乡的封印"},
            {"id": 85, "text": "星空下的门永远沉默"},
            {"id": 86, "text": "记忆的碎片在银河中燃烧"},
            {"id": 87, "text": "家的味道在宇宙中消失"},
            {"id": 88, "text": "无法破译的故乡信号"},
            {"id": 89, "text": "漂浮在星海中的时间"},
            {"id": 90, "text": "时间胶囊里的门锁"},
            {"id": 91, "text": "失重的记忆飘向永恒"},
            {"id": 92, "text": "星空是记忆的灰烬"},
            {"id": 93, "text": "门后的光年寂静"},
            {"id": 94, "text": "漂浮的故乡在星尘中湮灭"},
            {"id": 95, "text": "无法打开的空间门"},
            {"id": 96, "text": "记忆在星海中沉没"},
            {"id": 97, "text": "家的信号被星尘掩埋"},
            {"id": 98, "text": "漂浮的思念如星尘"},
            {"id": 99, "text": "月亮是故乡的墓碑"},
            {"id": 100, "text": "星空下的门永远关闭"},
            {"id": 101, "text": "记忆的碎片在银河中沉没"},
            {"id": 102, "text": "家的味道在真空中消失"},
            {"id": 103, "text": "无法接收的故乡信号"},
            {"id": 104, "text": "漂浮在星海中的记忆"},
            {"id": 105, "text": "时间胶囊里的故乡"},
            {"id": 106, "text": "失重的家飘向虚无"},
            {"id": 107, "text": "星空是记忆的坟墓"},
            {"id": 108, "text": "门后的光年等待"},
            {"id": 109, "text": "漂浮的故乡在星云中消散"},
            {"id": 110, "text": "无法打开的记忆门"},
            {"id": 111, "text": "记忆在星尘中燃烧"},
            {"id": 112, "text": "家的信号被星云遮蔽"},
            {"id": 113, "text": "漂浮的思念如星火"},
            {"id": 114, "text": "月亮是故乡的封印"},
            {"id": 115, "text": "星空下的门永远沉默"},
            {"id": 116, "text": "记忆的碎片在银河中燃烧"},
            {"id": 117, "text": "家的味道在宇宙中消失"},
            {"id": 118, "text": "无法破译的故乡信号"},
            {"id": 119, "text": "漂浮在星海中的时间"},
            {"id": 120, "text": "时间胶囊里的门锁"},
            {"id": 121, "text": "失重的记忆飘向永恒"},
            {"id": 122, "text": "星空是记忆的灰烬"},
            {"id": 123, "text": "门后的光年寂静"},
            {"id": 124, "text": "漂浮的故乡在星尘中湮灭"},
            {"id": 125, "text": "无法打开的空间门"},
            {"id": 126, "text": "记忆在星海中沉没"},
            {"id": 127, "text": "家的信号被星尘掩埋"},
            {"id": 128, "text": "漂浮的思念如星尘"},
            {"id": 129, "text": "月亮是故乡的墓碑"},
            {"id": 130, "text": "星空下的门永远关闭"},
            {"id": 131, "text": "记忆的碎片在银河中沉没"},
            {"id": 132, "text": "家的味道在真空中消失"},
            {"id": 133, "text": "无法接收的故乡信号"},
            {"id": 134, "text": "漂浮在星海中的记忆"},
            {"id": 135, "text": "时间胶囊里的故乡"},
            {"id": 136, "text": "失重的家飘向虚无"},
            {"id": 137, "text": "星空是记忆的坟墓"},
            {"id": 138, "text": "门后的光年等待"},
            {"id": 139, "text": "漂浮的故乡在星云中消散"},
            {"id": 140, "text": "无法打开的记忆门"},
            {"id": 141, "text": "记忆在星尘中燃烧"},
            {"id": 142, "text": "家的信号被星云遮蔽"},
            {"id": 143, "text": "漂浮的思念如星火"},
            {"id": 144, "text": "月亮是故乡的封印"},
            {"id": 145, "text": "星空下的门永远沉默"},
            {"id": 146, "text": "记忆的碎片在银河中燃烧"},
            {"id": 147, "text": "家的味道在宇宙中消失"},
            {"id": 148, "text": "无法破译的故乡信号"},
            {"id": 149, "text": "漂浮在星海中的时间"},
            {"id": 150, "text": "时间胶囊里的门锁"},
            {"id": 151, "text": "失重的记忆飘向永恒"},
            {"id": 152, "text": "星空是记忆的灰烬"},
            {"id": 153, "text": "门后的光年寂静"},
            {"id": 154, "text": "漂浮的故乡在星尘中湮灭"},
            {"id": 155, "text": "无法打开的空间门"},
            {"id": 156, "text": "记忆在星海中沉没"},
            {"id": 157, "text": "家的信号被星尘掩埋"},
            {"id": 158, "text": "漂浮的思念如星尘"},
            {"id": 159, "text": "月亮是故乡的墓碑"},
            {"id": 160, "text": "星空下的门永远关闭"},
            {"id": 161, "text": "记忆的碎片在银河中沉没"},
            {"id": 162, "text": "家的味道在真空中消失"},
            {"id": 163, "text": "无法接收的故乡信号"},
            {"id": 164, "text": "漂浮在星海中的记忆"},
            {"id": 165, "text": "时间胶囊里的故乡"},
            {"id": 166, "text": "失重的家飘向虚无"},
            {"id": 167, "text": "星空是记忆的坟墓"},
            {"id": 168, "text": "门后的光年等待"},
            {"id": 169, "text": "漂浮的故乡在星云中消散"},
            {"id": 170, "text": "无法打开的记忆门"},
            {"id": 171, "text": "记忆在星尘中燃烧"},
            {"id": 172, "text": "家的信号被星云遮蔽"},
            {"id": 173, "text": "漂浮的思念如星火"},
            {"id": 174, "text": "月亮是故乡的封印"},
            {"id": 175, "text": "星空下的门永远沉默"},
            {"id": 176, "text": "记忆的碎片在银河中燃烧"},
            {"id": 177, "text": "家的味道在宇宙中消失"},
            {"id": 178, "text": "无法破译的故乡信号"},
            {"id": 179, "text": "漂浮在星海中的时间"},
            {"id": 180, "text": "时间胶囊里的门锁"},
            {"id": 181, "text": "失重的记忆飘向永恒"},
            {"id": 182, "text": "星空是记忆的灰烬"},
            {"id": 183, "text": "门后的光年寂静"},
            {"id": 184, "text": "漂浮的故乡在星尘中湮灭"},
            {"id": 185, "text": "无法打开的空间门"},
            {"id": 186, "text": "记忆在星海中沉没"},
            {"id": 187, "text": "家的信号被星尘掩埋"},
            {"id": 188, "text": "漂浮的思念如星尘"},
            {"id": 189, "text": "月亮是故乡的墓碑"},
            {"id": 190, "text": "星空下的门永远关闭"},
            {"id": 191, "text": "记忆的碎片在银河中沉没"},
            {"id": 192, "text": "家的味道在真空中消失"},
            {"id": 193, "text": "无法接收的故乡信号"},
            {"id": 194, "text": "漂浮在星海中的记忆"},
            {"id": 195, "text": "时间胶囊里的故乡"},
            {"id": 196, "text": "失重的家飘向虚无"},
            {"id": 197, "text": "星空是记忆的坟墓"},
            {"id": 198, "text": "门后的光年等待"},
            {"id": 199, "text": "漂浮的故乡在星云中消散"},
            {"id": 200, "text": "无法打开的记忆门"}
        ];

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initThreeJS();
            initAudio();
            loadDynamicPoetry();
            createFloatingText();
            updateStats();
            hideLoading();
            startAutoChange();
        });

        // 加载动态诗歌数据库
        function loadDynamicPoetry() {
            const savedPoems = JSON.parse(localStorage.getItem('exhibition-poems') || '[]');
            
            if (savedPoems.length > 0) {
                // 使用用户生成的诗歌
                poetryDatabase.length = 0; // 清空默认数据
                poetryDatabase.push(...savedPoems);
            }
            // 如果没有用户诗歌，使用默认的200首
        }

        // 初始化 Three.js
        function initThreeJS() {
            const container = document.getElementById('three-container');
            
            // 创建场景
            scene = new THREE.Scene();
            
            // 创建相机
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 50;
            
            // 创建渲染器
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            container.appendChild(renderer.domElement);
            
            // 创建星星
            createStars();
            
            // 添加鼠标交互
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            
            function onMouseClick(event) {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(stars);
                
                if (intersects.length > 0) {
                    const star = intersects[0].object;
                    const poetryId = star.userData.poetryId;
                    showPoetry(poetryId);
                    
                    // 星星放大效果
                    star.scale.set(2, 2, 2);
                    setTimeout(() => {
                        star.scale.set(1, 1, 1);
                    }, 500);
                }
            }
            
            window.addEventListener('click', onMouseClick);
            window.addEventListener('resize', onWindowResize);
            
            // 开始渲染循环
            animate();
        }

        // 创建星星
        function createStars() {
            const starGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            
            for (let i = 0; i < poetryDatabase.length; i++) {
                const poetry = poetryDatabase[i];
                
                // 创建星星材质
                const starMaterial = new THREE.MeshBasicMaterial({
                    color: new THREE.Color().setHSL(0.6, 0.5, 0.7),
                    transparent: true,
                    opacity: 0.8
                });
                
                // 创建星星
                const star = new THREE.Mesh(starGeometry, starMaterial);
                
                // 随机位置
                star.position.x = (Math.random() - 0.5) * 100;
                star.position.y = (Math.random() - 0.5) * 100;
                star.position.z = (Math.random() - 0.5) * 100;
                
                // 添加诗歌数据
                star.userData.poetryId = poetry.id;
                
                // 添加到场景
                scene.add(star);
                stars.push(star);
            }
        }

        // 显示诗歌
        function showPoetry(poetryId) {
            const poetry = poetryDatabase.find(p => p.id === poetryId);
            if (!poetry) return;
            
            const text = document.getElementById('poetryText');
            const id = document.getElementById('poetryId');
            
            // 添加淡出效果
            text.style.opacity = '0';
            id.style.opacity = '0';
            
            setTimeout(() => {
                text.textContent = poetry.text;
                id.textContent = `诗歌 #${poetry.id}`;
                
                // 添加淡入效果
                text.style.opacity = '1';
                id.style.opacity = '1';
            }, 300);
            
            // 记录已探索的诗歌
            exploredPoems.add(poetryId);
            updateStats();
            
            // 播放音效
            if (soundEnabled) {
                playClickSound();
            }
        }

        // 切换菜单
        function toggleMenu() {
            const panel = document.getElementById('controlPanel');
            const toggle = document.getElementById('menuToggle');
            
            menuVisible = !menuVisible;
            
            if (menuVisible) {
                panel.classList.add('show');
                toggle.style.opacity = '1';
            } else {
                panel.classList.remove('show');
                toggle.style.opacity = '0.7';
            }
        }

        // 开始自动切换
        function startAutoChange() {
            if (autoChangeInterval) {
                clearInterval(autoChangeInterval);
            }
            
            autoChangeInterval = setInterval(() => {
                if (autoChangeEnabled) {
                    const randomId = Math.floor(Math.random() * poetryDatabase.length) + 1;
                    showPoetry(randomId);
                }
            }, 4000); // 每4秒切换一次
        }

        // 切换自动切换
        function toggleAutoChange() {
            autoChangeEnabled = !autoChangeEnabled;
            const btn = document.getElementById('autoBtn');
            
            if (autoChangeEnabled) {
                btn.textContent = '⏸️ 自动切换';
                startAutoChange();
            } else {
                btn.textContent = '▶️ 自动切换';
                if (autoChangeInterval) {
                    clearInterval(autoChangeInterval);
                }
            }
        }


        // 重置星星
        function resetStars() {
            stars.forEach(star => {
                star.position.x = (Math.random() - 0.5) * 100;
                star.position.y = (Math.random() - 0.5) * 100;
                star.position.z = (Math.random() - 0.5) * 100;
                star.scale.set(1, 1, 1);
            });
            
            exploredPoems.clear();
            updateStats();
        }

        // 显示所有诗歌
        function showAllPoetry() {
            currentMode = currentMode === 'overview' ? 'explore' : 'overview';
            updateStats();
            
            if (currentMode === 'overview') {
                // 创建总览窗口
                const overviewWindow = window.open('', '_blank', 'width=1200,height=800');
                overviewWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="zh-CN">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>诗歌总览</title>
                        <style>
                            body {
                                font-family: 'Source Han Serif SC', 'Source Han Serif CN', 'Noto Serif SC', 'Songti SC', 'SimSun', serif;
                                background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
                                color: white;
                                margin: 0;
                                padding: 20px;
                                overflow-x: hidden;
                            }
                            .overview-container {
                                max-width: 1000px;
                                margin: 0 auto;
                            }
                            .overview-title {
                                text-align: center;
                                font-size: 3rem;
                                font-weight: bold;
                                background: linear-gradient(45deg, #ffd700, #8b5cf6, #ec4899);
                                -webkit-background-clip: text;
                                -webkit-text-fill-color: transparent;
                                background-clip: text;
                                margin-bottom: 40px;
                            }
                            .poetry-grid {
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                                gap: 20px;
                            }
                            .poetry-card {
                                background: rgba(0, 0, 0, 0.3);
                                border: 2px solid rgba(255, 255, 255, 0.2);
                                border-radius: 15px;
                                padding: 20px;
                                backdrop-filter: blur(10px);
                            }
                            .poetry-card-text {
                                font-family: 'Source Han Serif SC', 'Source Han Serif CN', 'Noto Serif SC', 'Songti SC', 'SimSun', serif;
                                line-height: 1.8;
                                margin-bottom: 15px;
                                font-size: 1.1rem;
                            }
                            .poetry-card-id {
                                font-size: 0.9rem;
                                color: #999;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="overview-container">
                            <h1 class="overview-title">诗歌总览</h1>
                            <div class="poetry-grid">
                                ${poetryDatabase.map(poetry => `
                                    <div class="poetry-card">
                                        <div class="poetry-card-text">${poetry.text}</div>
                                        <div class="poetry-card-id">诗歌 #${poetry.id}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </body>
                    </html>
                `);
                overviewWindow.document.close();
            }
        }

        // 切换音效
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundBtn');
            btn.textContent = soundEnabled ? '🔊 音效' : '🔇 音效';
            
            if (soundEnabled && audioContext) {
                startHeartbeat();
            }
        }

        // 初始化音频
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                startHeartbeat();
            } catch (e) {
                console.log('Web Audio API not supported');
            }
        }

        // 开始心跳声
        function startHeartbeat() {
            if (!audioContext || !soundEnabled) return;
            
            function playHeartbeat() {
                if (!soundEnabled) return;
                
                // 创建心跳声 - 两个连续的低频脉冲
                const oscillator1 = audioContext.createOscillator();
                const oscillator2 = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator1.connect(gainNode);
                oscillator2.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // 第一个心跳
                oscillator1.frequency.setValueAtTime(40, audioContext.currentTime);
                oscillator1.frequency.exponentialRampToValueAtTime(20, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator1.start(audioContext.currentTime);
                oscillator1.stop(audioContext.currentTime + 0.1);
                
                // 第二个心跳（稍后）
                setTimeout(() => {
                    if (!soundEnabled) return;
                    oscillator2.frequency.setValueAtTime(40, audioContext.currentTime);
                    oscillator2.frequency.exponentialRampToValueAtTime(20, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator2.start(audioContext.currentTime);
                    oscillator2.stop(audioContext.currentTime + 0.1);
                }, 150);
                
                // 下次心跳
                setTimeout(playHeartbeat, 1000);
            }
            
            playHeartbeat();
        }

        // 播放点击音效
        function playClickSound() {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // 创建背景漂浮文字
        function createFloatingText() {
            const container = document.getElementById('floatingTextBg');
            
            // 选择一些诗歌作为背景漂浮文字（最多10首，避免过多）
            const backgroundPoems = poetryDatabase.filter((_, index) => index % 5 === 0).slice(0, 10);
            
            backgroundPoems.forEach((poetry, index) => {
                const textElement = document.createElement('div');
                textElement.className = 'floating-text-item';
                textElement.textContent = poetry.text;
                
                textElement.style.left = Math.random() * 100 + '%';
                textElement.style.top = Math.random() * 100 + '%';
                textElement.style.animationDelay = Math.random() * 12 + 's';
                textElement.style.animationDuration = (10 + Math.random() * 8) + 's';
                
                container.appendChild(textElement);
            });
        }

        // 更新统计信息
        function updateStats() {
            document.getElementById('totalCount').textContent = poetryDatabase.length;
            document.getElementById('exploredCount').textContent = exploredPoems.size;
            document.getElementById('currentMode').textContent = currentMode === 'explore' ? '探索模式' : '总览模式';
        }

        // 隐藏加载提示
        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }

        // 窗口大小改变
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            
            // 旋转星星
            stars.forEach((star, index) => {
                star.rotation.x += 0.01;
                star.rotation.y += 0.01;
                
                // 轻微浮动
                star.position.y += Math.sin(Date.now() * 0.001 + index) * 0.01;
            });
            
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
